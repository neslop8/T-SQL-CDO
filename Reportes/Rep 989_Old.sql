SELECT
	GENPACIEN.PACPRINOM AS PRIMER_NOMBRE
	,GENPACIEN.PACSEGNOM AS SEGUNDO_NOMBRE
	,GENPACIEN.PACPRIAPE AS PRIMER_APELLIDO
	,GENPACIEN.PACSEGAPE AS SEGUNDO_PAELLIDO
	,CASE GENPACIEN.PACTIPDOC 
		WHEN 1 THEN 'CC' 
		WHEN 2 THEN 'CE' 
		WHEN 3 then 'TI' 
		WHEN 4 then 'RC' 
		WHEN 5 then 'PA' 
		WHEN 6 then 'AS' 
		WHEN 7 then 'MS' 
		WHEN 8 then 'NU' 
		WHEN 9 then 'NI' 
		WHEN 10 then 'CD'  END AS TIPO_IDENTIFICACION
	,GENPACIEN.PACNUMDOC AS NUMERO_IDENTIFICACION
	,CONVERT(VARCHAR(10),GENPACIEN.GPAFECNAC,120) AS FECHA_NACIMIENTO
	,CASE GENPACIEN.GPASEXPAC
		WHEN 1 THEN 'H'
		WHEN 2 THEN 'M'
		WHEN 3 THEN 'I' END AS SEXO
	,GENOCUPACION.DGONOMBRE AS OCUPACION
	,CASE GENPACIEN.GPATIPPAC
		WHEN 0 THEN 'NINGUNO'
		WHEN 1 THEN 'CONTRIBUTIVO'
		WHEN 2 THEN 'SUBSIDIADO'
		WHEN 3 THEN 'VINCULADO'
		WHEN 4 THEN 'PARTICULAR'
		WHEN 5 THEN 'OTRO'
		WHEN 6 THEN 'DESPLAZADO REGIMEN CONTRIBUTIVO'
		WHEN 7 THEN 'DESPLAZADO REGIMEN SUBSIDIADO'
		WHEN 8 THEN 'DESPLAZADO NO ASEGURADO' END AS REGIMEN
	,pla.GECCODIGO AS CODIGO_EPS
	,CASE WHEN ADNGRUETN.ADGECODIGO IS NULL 
		THEN '' ELSE ADNGRUETN.ADGECODIGO END AS CODIGO_ETNICO
	,' ' AS GRUPO_POBLACIONAL
	,GENMUNICI.MUNNOMMUN AS MUNICIPIO_RESIDENCIA
	,PAcienteTelelfono.PACTELEFONO AS TELEFONO_PACIENTE
	,CONVERT(VARCHAR(10),GENPACIEN.GPAFECING,120) AS FECHA_AFILIACION_EAPB
	,GENDIAGNO.DIANOMBRE AS NOMBRE_NEOPLASIA
	,DATEDIFF(yy,GENPACIEN.GPAFECNAC,ADNEGRESO.ADEFECSAL) AS EDAD_MOMENTO_DIAGNOSTICO
	,GENDIAGNO.DIACODIGO AS CODIGO_DIAGNOSTICO
	,GENDIAGNO.DIACODCIE AS CODIGO_CIE_10
        ,ADNINGRESO.AINTIPING AS TIPO
FROM 
	DGEMPRES21..ADNDIAEGR
	INNER JOIN DGEMPRES21..GENDIAGNO ON ADNDIAEGR.DIACODIGO = GENDIAGNO.OID
	INNER JOIN DGEMPRES21..ADNEGRESO ON ADNDIAEGR.ADNEGRESO = ADNEGRESO.OID
	INNER JOIN DGEMPRES21..ADNINGRESO ON ADNEGRESO.ADNINGRESO = ADNINGRESO.OID
	INNER JOIN DGEMPRES21..GENPACIEN ON GENPACIEN.OID = ADNINGRESO.GENPACIEN
	LEFT JOIN DGEMPRES21..GENOCUPACION ON GENOCUPACION.OID = GENPACIEN.GENOCUPACION
	LEFT JOIN DGEMPRES21..GENDETCON con on con.OID = ADNINGRESO.GENDETCON
	LEFT JOIN DGEMPRES21..GENCONTRA pla on pla.OID = con.GENCONTRA1
	LEFT JOIN DGEMPRES21..ADNGRUETN ON ADNGRUETN.OID = GENPACIEN.ADNGRUETN
	LEFT JOIN dgempres21..GENMUNICI ON GENMUNICI.OID = GENPACIEN.DGNMUNICIPIO
	LEFT JOIN dgempres21..GENDEPTO ON GENDEPTO.OID = GENMUNICI.GENDEPTO
	OUTER APPLY 
		(SELECT TOP 1 PACTELEFONO FROM dgempres21..GENPACIENT WHERE GENPACIEN= GENPACIEN.OID
			ORDER BY OID) AS PAcienteTelelfono
WHERE 
	ADNEGRESO.ADEFECSAL>=@fch_inicio
	AND ADNEGRESO.ADEFECSAL<=@fch_fin
	AND ADNDIAEGR.TIPO=5
	AND GENDIAGNO.DIACODCIE IN (
		'C000'
,'C001'
,'C002'
,'C003'
,'C004'
,'C005'
,'C006'
,'C008'
,'C009'
,'C01X'
,'C020'
,'C021'
,'C022'
,'C023'
,'C024'
,'C028'
,'C029'
,'C030'
,'C031'
,'C039'
,'C040'
,'C041'
,'C048'
,'C049'
,'C050'
,'C051'
,'C052'
,'C058'
,'C059'
,'C060'
,'C061'
,'C062'
,'C068'
,'C069'
,'C07X'
,'C080'
,'C081'
,'C088'
,'C089'
,'C090'
,'C091'
,'C098'
,'C099'
,'C100'
,'C101'
,'C102'
,'C103'
,'C104'
,'C108'
,'C109'
,'C110'
,'C111'
,'C112'
,'C113'
,'C118'
,'C119'
,'C12X'
,'C130'
,'C131'
,'C132'
,'C138'
,'C139'
,'C140'
,'C142'
,'C148'
,'C150'
,'C151'
,'C152'
,'C153'
,'C154'
,'C155'
,'C158'
,'C159'
,'C160'
,'C161'
,'C162'
,'C163'
,'C164'
,'C165'
,'C166'
,'C168'
,'C169'
,'C170'
,'C171'
,'C172'
,'C173'
,'C178'
,'C179'
,'C180'
,'C181'
,'C182'
,'C183'
,'C184'
,'C185'
,'C186'
,'C187'
,'C188'
,'C189'
,'C19X'
,'C20X'
,'C210'
,'C211'
,'C212'
,'C218'
,'C220'
,'C221'
,'C222'
,'C223'
,'C224'
,'C227'
,'C229'
,'C23X'
,'C240'
,'C241'
,'C248'
,'C249'
,'C250'
,'C251'
,'C252'
,'C253'
,'C254'
,'C257'
,'C258'
,'C259'
,'C260'
,'C261'
,'C268'
,'C269'
,'C300'
,'C301'
,'C310'
,'C311'
,'C312'
,'C313'
,'C318'
,'C319'
,'C320'
,'C321'
,'C322'
,'C323'
,'C328'
,'C329'
,'C33X'
,'C340'
,'C341'
,'C342'
,'C343'
,'C348'
,'C349'
,'C37X'
,'C380'
,'C381'
,'C382'
,'C383'
,'C384'
,'C388'
,'C390'
,'C398'
,'C399'
,'C400'
,'C401'
,'C402'
,'C403'
,'C408'
,'C409'
,'C410'
,'C411'
,'C412'
,'C413'
,'C414'
,'C418'
,'C419'
,'C430'
,'C431'
,'C432'
,'C433'
,'C434'
,'C435'
,'C436'
,'C437'
,'C438'
,'C439'
,'C440'
,'C441'
,'C442'
,'C443'
,'C444'
,'C445'
,'C446'
,'C447'
,'C448'
,'C449'
,'C450'
,'C451'
,'C452'
,'C457'
,'C459'
,'C460'
,'C461'
,'C462'
,'C463'
,'C467'
,'C468'
,'C469'
,'C470'
,'C471'
,'C472'
,'C473'
,'C474'
,'C475'
,'C476'
,'C478'
,'C479'
,'C480'
,'C481'
,'C482'
,'C488'
,'C490'
,'C491'
,'C492'
,'C493'
,'C494'
,'C495'
,'C496'
,'C498'
,'C499'
,'C500'
,'C501'
,'C502'
,'C503'
,'C504'
,'C505'
,'C506'
,'C508'
,'C509'
,'C510'
,'C511'
,'C512'
,'C518'
,'C519'
,'C52X'
,'C530'
,'C531'
,'C538'
,'C539'
,'C540'
,'C541'
,'C542'
,'C543'
,'C548'
,'C549'
,'C55X'
,'C56X'
,'C570'
,'C571'
,'C572'
,'C573'
,'C574'
,'C577'
,'C578'
,'C579'
,'C58X'
,'C600'
,'C601'
,'C602'
,'C608'
,'C609'
,'C61X'
,'C620'
,'C621'
,'C629'
,'C630'
,'C631'
,'C632'
,'C637'
,'C638'
,'C639'
,'C64X'
,'C65X'
,'C66X'
,'C670'
,'C671'
,'C672'
,'C673'
,'C674'
,'C675'
,'C676'
,'C677'
,'C678'
,'C679'
,'C680'
,'C681'
,'C688'
,'C689'
,'C690'
,'C691'
,'C692'
,'C693'
,'C694'
,'C695'
,'C696'
,'C698'
,'C699'
,'C700'
,'C701'
,'C709'
,'C710'
,'C711'
,'C712'
,'C713'
,'C714'
,'C715'
,'C716'
,'C717'
,'C718'
,'C719'
,'C720'
,'C721'
,'C722'
,'C723'
,'C724'
,'C725'
,'C728'
,'C729'
,'C73X'
,'C740'
,'C741'
,'C749'
,'C750'
,'C751'
,'C752'
,'C753'
,'C754'
,'C755'
,'C758'
,'C759'
,'C760'
,'C761'
,'C762'
,'C763'
,'C764'
,'C765'
,'C767'
,'C768'
,'C770'
,'C771'
,'C772'
,'C773'
,'C774'
,'C775'
,'C778'
,'C779'
,'C780'
,'C781'
,'C782'
,'C783'
,'C784'
,'C785'
,'C786'
,'C787'
,'C788'
,'C790'
,'C791'
,'C792'
,'C793'
,'C794'
,'C795'
,'C796'
,'C797'
,'C798'
,'C80X'
,'C810'
,'C811'
,'C812'
,'C813'
,'C817'
,'C819'
,'C820'
,'C821'
,'C822'
,'C827'
,'C829'
,'C830'
,'C831'
,'C832'
,'C833'
,'C834'
,'C835'
,'C836'
,'C837'
,'C838'
,'C839'
,'C840'
,'C841'
,'C842'
,'C843'
,'C844'
,'C845'
,'C850'
,'C851'
,'C857'
,'C859'
,'C880'
,'C881'
,'C882'
,'C883'
,'C887'
,'C889'
,'C900'
,'C901'
,'C902'
,'C910'
,'C911'
,'C912'
,'C913'
,'C914'
,'C915'
,'C917'
,'C919'
,'C920'
,'C921'
,'C922'
,'C923'
,'C924'
,'C925'
,'C927'
,'C929'
,'C930'
,'C931'
,'C932'
,'C937'
,'C939'
,'C940'
,'C941'
,'C942'
,'C943'
,'C944'
,'C945'
,'C947'
,'C950'
,'C951'
,'C952'
,'C957'
,'C959'
,'C960'
,'C961'
,'C962'
,'C963'
,'C967'
,'C969'
,'C97X'
,'D000'
,'D001'
,'D002'
,'D010'
,'D011'
,'D012'
,'D013'
,'D014'
,'D015'
,'D017'
,'D019'
,'D020'
,'D021'
,'D022'
,'D023'
,'D024'
,'D030'
,'D031'
,'D032'
,'D033'
,'D034'
,'D035'
,'D036'
,'D037'
,'D038'
,'D039'
,'D040'
,'D041'
,'D042'
,'D043'
,'D044'
,'D045'
,'D046'
,'D047'
,'D048'
,'D049'
,'D050'
,'D051'
,'D057'
,'D059'
,'D060'
,'D061'
,'D067'
,'D069'
,'D070'
,'D071'
,'D072'
,'D073'
,'D074'
,'D075'
,'D076'
,'D090'
,'D091'
,'D092'
,'D093'
,'D097'
,'D099'
) 