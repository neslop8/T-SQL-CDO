use dgempres21
-----------------------------------------------------------------------------------------------------------------------------------
declare @nomina datetime = '2016-30-08 23:59:59'
-----------------------------------------------------------------------------------------------------------------------------------
select emp.EMPCODIGO documento, gru.GRUCODIGO cod, gru.GRUNOMBRE grupo, sgru.SUBCODIGO subgrupo, sgru.SUBNOMBRE nom_sub
, emp.EMPAPELLI1 +' '+ emp.EMPAPELLI2 +' '+ emp.EMPNOMBRE1 +' '+ emp.EMPNOMBRE2 EMPLEADO, nome.NEMSUELBAS basico
, case nome.NEMLIQCON when 1 then 'Nom' when 2 then 'Ret' else 'Otro' end
, C001.Cant, C001.Cuenta, C001.C001, C002.Cuenta, C002.C002, C004.Cuenta, C004.C004, C005.Cuenta, C005.C005
, C006.Cuenta, C006.C006, C007.Cuenta, C007.C007, C008.Cuenta, C008.C008, C009.Cuenta, C009.C009
, C010.Cuenta, C010.C010, C011.Cuenta, C011.C011, C012.Cuenta, C012.C012, C013.Cuenta, C013.C013
, C015.Cuenta, C015.C015, C020.Cuenta, C020.C020, C021.Cuenta, C021.C021, C027.Cuenta, C027.C027
, C031.Cuenta, C031.C031, C100.Cuenta, C100.C100, C101.Cuenta, C101.C101, C112.Cuenta, C112.C112
, C113.Cuenta, C113.C113, C114.Cuenta, C114.C114, C115.Cuenta, C115.C115, C116.Cuenta, C116.C116
, C117.Cuenta, C117.C117, C118.Cuenta, C118.C118, C120.Cuenta, C120.C120, C121.Cuenta, C121.C121, CRE01.Cuenta, CRE01.CRE01
, CRE02.Cuenta, CRE02.CRE02, CRE04.Cuenta, CRE04.CRE04, CRE05.Cuenta, CRE05.CRE05, CRE06.Cuenta, CRE06.CRE06
--desde aqui deducidos
, C500.Cuenta, C500.C500, C501.Cuenta, C501.C501, C502.Cuenta, C502.C502, C503.Cuenta, C503.C503
, C506.Cuenta, C506.C506, C507.Cuenta, C507.C507, C515.Cuenta, C515.C515, C520.Cuenta, C520.C520
, C521.Cuenta, C521.C521, C522.Cuenta, C522.C522, C523.Cuenta, C523.C523, C524.Cuenta, C524.C524
, C526.Cuenta, C526.C526, C527.Cuenta, C527.C527, C528.Cuenta, C528.C528, C529.Cuenta, C529.C529
, C530.Cuenta, C530.C530, C600.Cuenta, C600.C600, C601.Cuenta, C601.C601, C603.Cuenta, C603.C603
, C604.Cuenta, C604.C604, C620.Cuenta, C620.C620, C997.Cuenta, C997.C997
, C998.Cuenta, C998.C998, C999.Cuenta, C999.C999
,( ISNULL(C001.C001, 0) + ISNULL(C002.C002, 0) + ISNULL(C004.C004, 0) + ISNULL(C005.C005, 0) + ISNULL(C006.C006, 0)
 + ISNULL(C007.C007, 0) + ISNULL(C008.C008, 0) + ISNULL(C009.C009, 0) + ISNULL(C010.C010, 0) + ISNULL(C011.C011, 0) 
 + ISNULL(C012.C012, 0) + ISNULL(C013.C013, 0) + ISNULL(C015.C015, 0) + ISNULL(C020.C020, 0) + ISNULL(C021.C021, 0)
 + ISNULL(C027.C027, 0) + ISNULL(C031.C031, 0) + ISNULL(C100.C100, 0) + ISNULL(C101.C101, 0) + ISNULL(C112.C112, 0)
 + ISNULL(C113.C113, 0) + ISNULL(C114.C114, 0) + ISNULL(C115.C115, 0) + ISNULL(C116.C116, 0) + ISNULL(C117.C117, 0) 
 + ISNULL(C118.C118, 0) + ISNULL(C120.C120, 0) + ISNULL(C121.C121, 0) + ISNULL(CRE01.CRE01, 0) + ISNULL(CRE02.CRE02, 0) 
 + ISNULL(CRE04.CRE04, 0) + ISNULL(CRE05.CRE05, 0) + ISNULL(CRE06.CRE06, 0)) Tot_Dev
  ,( ISNULL(C500.C500, 0) + ISNULL(C501.C501, 0) + ISNULL(C502.C502, 0) + ISNULL(C503.C503, 0) + ISNULL(C506.C506, 0)
 + ISNULL(C507.C507, 0) + ISNULL(C515.C515, 0) + ISNULL(C520.C520, 0) + ISNULL(C521.C521, 0) + ISNULL(C522.C522, 0)
 + ISNULL(C523.C523, 0) + ISNULL(C524.C524, 0) + ISNULL(C526.C526, 0) + ISNULL(C527.C527, 0) + ISNULL(C528.C528, 0)
 + ISNULL(C529.C529, 0) + ISNULL(C530.C530, 0) + ISNULL(C600.C600, 0) + ISNULL(C601.C601, 0) + ISNULL(C603.C603, 0)
 + ISNULL(C604.C604, 0) + ISNULL(C620.C620, 0) 
 + ISNULL(C997.C997, 0) + ISNULL(C998.C998, 0) + ISNULL(C999.C999, 0)) Tot_Ded
 
 , (( ISNULL(C001.C001, 0) + ISNULL(C002.C002, 0) + ISNULL(C004.C004, 0) + ISNULL(C005.C005, 0) + ISNULL(C006.C006, 0)
 + ISNULL(C007.C007, 0) + ISNULL(C008.C008, 0) + ISNULL(C009.C009, 0) + ISNULL(C010.C010, 0) + ISNULL(C011.C011, 0) 
 + ISNULL(C012.C012, 0) + ISNULL(C013.C013, 0) + ISNULL(C015.C015, 0) + ISNULL(C020.C020, 0) + ISNULL(C021.C021, 0)
 + ISNULL(C027.C027, 0) + ISNULL(C031.C031, 0) + ISNULL(C100.C100, 0) + ISNULL(C101.C101, 0) + ISNULL(C112.C112, 0)
 + ISNULL(C113.C113, 0) + ISNULL(C114.C114, 0) + ISNULL(C115.C115, 0) + ISNULL(C116.C116, 0) + ISNULL(C117.C117, 0) 
 + ISNULL(C118.C118, 0) + ISNULL(C120.C120, 0) + ISNULL(C121.C121, 0) + ISNULL(CRE01.CRE01, 0) + ISNULL(CRE02.CRE02, 0) 
 + ISNULL(CRE04.CRE04, 0) + ISNULL(CRE05.CRE05, 0) + ISNULL(CRE06.CRE06, 0)) 
 - ( ISNULL(C500.C500, 0) + ISNULL(C501.C501, 0) + ISNULL(C502.C502, 0) + ISNULL(C503.C503, 0) + ISNULL(C506.C506, 0)
 + ISNULL(C507.C507, 0) + ISNULL(C515.C515, 0) + ISNULL(C520.C520, 0) + ISNULL(C521.C521, 0) + ISNULL(C522.C522, 0)
 + ISNULL(C523.C523, 0) + ISNULL(C524.C524, 0) + ISNULL(C526.C526, 0) + ISNULL(C527.C527, 0) + ISNULL(C528.C528, 0)
 + ISNULL(C529.C529, 0) + ISNULL(C530.C530, 0) + ISNULL(C600.C600, 0) + ISNULL(C601.C601, 0) + ISNULL(C603.C603, 0)
 + ISNULL(C604.C604, 0) + ISNULL(C620.C620, 0) 
 + ISNULL(C997.C997, 0) + ISNULL(C998.C998, 0) + ISNULL(C999.C999, 0))) Neto_Pagar
 
from dgempres21..NOMEMPLEADO emp inner join dgempres21..NOMNOMINAE nome on nome.NOMEMPLEA=emp.OID
INNER JOIN dgempres21..NOMNOMINA nom   on nome.NOMNOMINA=nom.OID and nom.nomfecha = @nomina
INNER JOIN dgempres21..NOMGRUPO gru    on nom.NOMGRUPO=gru.OID
INNER JOIN dgempres21..NOMSUBGRU sgru  on emp.NOMSUBGRU=sgru.oid

OUTER APPLY DGEMPRES21..f_nomina_empleado_C001(nome.OID) C001
OUTER APPLY DGEMPRES21..f_nomina_empleado_C002(nome.OID) C002
OUTER APPLY DGEMPRES21..f_nomina_empleado_C004(nome.OID) C004
OUTER APPLY DGEMPRES21..f_nomina_empleado_C005(nome.OID) C005
OUTER APPLY DGEMPRES21..f_nomina_empleado_C006(nome.OID) C006
OUTER APPLY DGEMPRES21..f_nomina_empleado_C007(nome.OID) C007
OUTER APPLY DGEMPRES21..f_nomina_empleado_C008(nome.OID) C008
OUTER APPLY DGEMPRES21..f_nomina_empleado_C009(nome.OID) C009
OUTER APPLY DGEMPRES21..f_nomina_empleado_C010(nome.OID) C010
OUTER APPLY DGEMPRES21..f_nomina_empleado_C011(nome.OID) C011
OUTER APPLY DGEMPRES21..f_nomina_empleado_C012(nome.OID) C012
OUTER APPLY DGEMPRES21..f_nomina_empleado_C013(nome.OID) C013
OUTER APPLY DGEMPRES21..f_nomina_empleado_C015(nome.OID) C015
OUTER APPLY DGEMPRES21..f_nomina_empleado_C020(nome.OID) C020
OUTER APPLY DGEMPRES21..f_nomina_empleado_C021(nome.OID) C021
OUTER APPLY DGEMPRES21..f_nomina_empleado_C027(nome.OID) C027
OUTER APPLY DGEMPRES21..f_nomina_empleado_C031(nome.OID) C031
OUTER APPLY DGEMPRES21..f_nomina_empleado_C100(nome.OID) C100
OUTER APPLY DGEMPRES21..f_nomina_empleado_C101(nome.OID) C101
OUTER APPLY DGEMPRES21..f_nomina_empleado_C112(nome.OID) C112
OUTER APPLY DGEMPRES21..f_nomina_empleado_C113(nome.OID) C113
OUTER APPLY DGEMPRES21..f_nomina_empleado_C114(nome.OID) C114
OUTER APPLY DGEMPRES21..f_nomina_empleado_C115(nome.OID) C115
OUTER APPLY DGEMPRES21..f_nomina_empleado_C116(nome.OID) C116
OUTER APPLY DGEMPRES21..f_nomina_empleado_C117(nome.OID) C117
OUTER APPLY DGEMPRES21..f_nomina_empleado_C118(nome.OID) C118
OUTER APPLY DGEMPRES21..f_nomina_empleado_C120(nome.OID) C120
OUTER APPLY DGEMPRES21..f_nomina_empleado_C121(nome.OID) C121
OUTER APPLY DGEMPRES21..f_nomina_empleado_CRE01(nome.OID) CRE01
OUTER APPLY DGEMPRES21..f_nomina_empleado_CRE02(nome.OID) CRE02
OUTER APPLY DGEMPRES21..f_nomina_empleado_CRE04(nome.OID) CRE04
OUTER APPLY DGEMPRES21..f_nomina_empleado_CRE05(nome.OID) CRE05
OUTER APPLY DGEMPRES21..f_nomina_empleado_CRE06(nome.OID) CRE06--desde aqui deducidos
OUTER APPLY DGEMPRES21..f_nomina_empleado_C500(nome.OID) C500
OUTER APPLY DGEMPRES21..f_nomina_empleado_C501(nome.OID) C501
OUTER APPLY DGEMPRES21..f_nomina_empleado_C502(nome.OID) C502
OUTER APPLY DGEMPRES21..f_nomina_empleado_C503(nome.OID) C503
OUTER APPLY DGEMPRES21..f_nomina_empleado_C506(nome.OID) C506
OUTER APPLY DGEMPRES21..f_nomina_empleado_C507(nome.OID) C507
OUTER APPLY DGEMPRES21..f_nomina_empleado_C515(nome.OID) C515
OUTER APPLY DGEMPRES21..f_nomina_empleado_C520(nome.OID) C520
OUTER APPLY DGEMPRES21..f_nomina_empleado_C521(nome.OID) C521
OUTER APPLY DGEMPRES21..f_nomina_empleado_C522(nome.OID) C522
OUTER APPLY DGEMPRES21..f_nomina_empleado_C523(nome.OID) C523
OUTER APPLY DGEMPRES21..f_nomina_empleado_C524(nome.OID) C524
OUTER APPLY DGEMPRES21..f_nomina_empleado_C526(nome.OID) C526
OUTER APPLY DGEMPRES21..f_nomina_empleado_C527(nome.OID) C527
OUTER APPLY DGEMPRES21..f_nomina_empleado_C528(nome.OID) C528
OUTER APPLY DGEMPRES21..f_nomina_empleado_C529(nome.OID) C529
OUTER APPLY DGEMPRES21..f_nomina_empleado_C530(nome.OID) C530
OUTER APPLY DGEMPRES21..f_nomina_empleado_C600(nome.OID) C600
OUTER APPLY DGEMPRES21..f_nomina_empleado_C601(nome.OID) C601
OUTER APPLY DGEMPRES21..f_nomina_empleado_C603(nome.OID) C603
OUTER APPLY DGEMPRES21..f_nomina_empleado_C604(nome.OID) C604
OUTER APPLY DGEMPRES21..f_nomina_empleado_C620(nome.OID) C620
OUTER APPLY DGEMPRES21..f_nomina_empleado_C997(nome.OID) C997
OUTER APPLY DGEMPRES21..f_nomina_empleado_C998(nome.OID) C998
OUTER APPLY DGEMPRES21..f_nomina_empleado_C999(nome.OID) C999
--where emp.EMPCODIGO in ('76324244', '52067554', '51643927', '19457174', '3228732', '39775214', '79538119')
--where nom.NOMORIGEN=1
order by 2,1
-----------------------------------------------------------------------------------------------------------------------------------